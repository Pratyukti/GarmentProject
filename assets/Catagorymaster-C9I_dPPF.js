import{r,j as e,v as M,w as c,D as T,x as k,y as A,z as O,F as m,H as I,I as Q,J as V,K as X,M as W,O as s,Q as G,S as K,U as Y,V as Z,X as ee,W as x}from"./index-B24U4oXx.js";import{C as N}from"./CircularProgress-BB-a29aZ.js";function ne(){const[o,i]=r.useState({category_name:"",category_code:"",sub_category_name:{},description:""}),[d,u]=r.useState([]),[p,f]=r.useState({add:!1,fetch:!0}),[B,g]=r.useState(!1),[y,_]=r.useState(null),[L,j]=r.useState(!1),[b,U]=r.useState(null),F=r.useRef(null),w=r.useRef(null),v=r.useRef(null),R=r.useRef(null);r.useEffect(()=>{(async()=>{try{const t=(await x.get("/api/user/categories/")).data.reduce((l,D)=>(l[D.category_code]={...D,sub_category_name:D.sub_category_name.map(J=>({sub_category_name:J}))},l),{});u(t)}catch(n){console.error("Fetch error:",n)}finally{f(n=>({...n,fetch:!1}))}})()},[]);const h=a=>{i({...o,[a.target.name]:a.target.value})},P=()=>{g(!0),_(null),i({category_name:"",category_code:"",sub_category_name:"",description:""})},S=()=>{g(!1)},q=a=>{const n=d[a];i({...n,sub_category_name:n.sub_category_name.join(", ")}),_(a),g(!0)},z=async a=>{a.preventDefault(),f(t=>({...t,add:!0}));const n={...o,sub_category_name:o.sub_category_name.split(",").map(t=>({name:t.trim()}))};try{if(y!==null){const t=await x.put(`/api/user/categories/${o.category_name}/`,n);u(l=>({...l,[o.category_code]:t.data.data})),alert(t.data.message),_(null)}else{const t=await x.post("/api/user/categories/",n);u(l=>({...l,[t.data.data.category_code]:t.data.data})),alert(t.data.message)}}catch(t){console.error("Error saving category:",t)}finally{f(t=>({...t,add:!1})),i({category_name:"",category_code:"",sub_category_name:"",description:""}),g(!1)}},H=a=>{j(!0),U(a)},$=async()=>{try{await x.delete(`/api/user/categories/${d[b].category_name}/`);const a=d.filter((n,t)=>t!==b);u(a),alert("Category deleted successfully!")}catch(a){console.error("Error deleting category:",a)}finally{j(!1)}},E=()=>{j(!1)},C=(a,n)=>{a.key==="Enter"&&n.current&&(a.preventDefault(),n.current.focus())};return e.jsxs(M,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(c,{variant:"contained",color:"secondary",onClick:P,children:y!==null?"Edit Category":"Add Category"}),e.jsxs(T,{open:B,onClose:S,children:[e.jsx(k,{children:y!==null?"Edit Category Details":"Add Category Details"}),e.jsx(A,{children:e.jsx(O,{sx:{padding:"10px"},elevation:0,children:e.jsxs("form",{children:[e.jsx(m,{fullWidth:!0,label:"Category Name",name:"category_name",value:o.category_name,onChange:h,onKeyDown:a=>C(a,w),inputRef:F,margin:"normal",required:!0}),e.jsx(m,{fullWidth:!0,label:"Category Code",name:"category_code",value:o.category_code,onChange:h,onKeyDown:a=>C(a,v),inputRef:w,margin:"normal",required:!0}),e.jsx(m,{fullWidth:!0,label:"Sub-Category Names ",name:"sub_category_name",value:o.sub_category_name,onChange:h,onKeyDown:a=>C(a,R),inputRef:v,margin:"normal"}),e.jsx(m,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:o.description,onChange:h,inputRef:R,margin:"normal"})]})})}),e.jsxs(I,{children:[e.jsx(c,{onClick:S,color:"error",children:"Cancel"}),e.jsx(c,{onClick:z,color:"secondary",disabled:p.add,children:p.add?e.jsx(N,{size:24}):y!==null?"Update":"Add"})]})]}),p.fetch?e.jsx(N,{}):e.jsx(Q,{component:O,sx:{marginTop:3},children:e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(W,{children:[e.jsx(s,{children:"Category Name"}),e.jsx(s,{children:"Category Code"}),e.jsx(s,{children:"Sub-Category Names"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Actions"})]})}),e.jsx(G,{children:Object.values(d).map(a=>e.jsxs(W,{children:[e.jsx(s,{children:a.category_name}),e.jsx(s,{children:a.category_code}),e.jsx(s,{style:{width:"350px",overflow:"hidden",textOverflow:"ellipsis"},children:Array.isArray(a.sub_category_name)&&a.sub_category_name.length>0?a.sub_category_name.map(n=>{var t;return((t=n==null?void 0:n.sub_category_name)==null?void 0:t.name)||"Unnamed Subcategory"}).join(", "):"No Subcategories"}),e.jsx(s,{children:a.description}),e.jsxs(s,{children:[e.jsx(K,{color:"secondary",onClick:()=>q(a.category_code),children:e.jsx(Y,{})}),e.jsx(K,{color:"error",onClick:()=>H(a.category_code),children:e.jsx(Z,{})})]})]},a.category_code))})]})}),e.jsxs(T,{open:L,onClose:E,children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(A,{children:e.jsx(ee,{children:"Are you sure you want to delete this category?"})}),e.jsxs(I,{children:[e.jsx(c,{onClick:E,color:"secondary",children:"Cancel"}),e.jsx(c,{onClick:$,color:"error",children:"Confirm"})]})]})]})}export{ne as default};
