import{r as i,j as e,v as X,w as u,D as v,x as k,y as D,z as I,G as n,Y as E,Z as A,_ as W,$ as T,F as d,S as _,V as q,H as w,I as ee,J as se,K as te,M as N,O as o,Q as ae,U as re,W as h}from"./index-B24U4oXx.js";import{C as ne}from"./CircularProgress-BB-a29aZ.js";function le(){const[r,l]=i.useState({item_name:"",item_code:"",sizes:[{size:"",unit_price:"",stock_quantity:""}],hsn_code:"",description:"",category_item:"",sub_category:""}),[c,x]=i.useState([]),[O,L]=i.useState([]),[B,H]=i.useState([]),[g,b]=i.useState({add:!1}),[P,p]=i.useState(!1),[j,z]=i.useState(null),[R,U]=i.useState(null),[$,y]=i.useState(!1);i.useRef([]),i.useEffect(()=>{const s=async()=>{try{const t=await h.get("/api/user/items/");x(t.data.data)}catch(t){console.error("Error fetching items:",t)}},a=async()=>{try{const t=await h.get("/api/user/categories/");L(t.data)}catch(t){console.error("Error fetching categories:",t)}};s(),a()},[]);const F=async s=>{const a=s.target.value;l({...r,category_name:a,sub_category_name:""});try{const t=await h.get(`/api/user/subcategories/${a}/`);H(t.data)}catch(t){console.error("Error fetching subcategories:",t)}},m=s=>{l({...r,[s.target.name]:s.target.value})},C=(s,a)=>{const t=[...r.sizes];t[a][s.target.name]=s.target.value,l({...r,sizes:t})},M=()=>{l({...r,sizes:[...r.sizes,{size:"",unit_price:"",stock_quantity:""}]})},Q=s=>{const a=r.sizes.filter((t,Z)=>Z!==s);l({...r,sizes:a})},G=()=>{p(!0),z(null),l({item_name:"",item_code:"",sizes:[{size:"",unit_price:"",stock_quantity:""}],hsn_code:"",description:""})},f=()=>{p(!1)},J=async s=>{s.preventDefault(),b({...g,add:!0});try{if(j!==null){const a=await h.put(`/api/user/items/${r.item_code}/`,r),t=[...c];t[j]={...c[j],...r},x(t),alert(a.data.message)}else{const a=await h.post("/api/user/items-post/",r);x([...c,a.data]),alert(a.data.message)}}catch(a){console.error("Error adding/updating item:",a),alert("Error adding/updating item:",a)}finally{b({...g,add:!1}),f()}},K=s=>{z(s),l(c[s]),p(!0)},V=s=>{U(s),y(!0),l(c[s])},S=()=>{y(!1)},Y=async()=>{try{await h.delete(`/api/user/items/${r.item_code}/`);const s=c.filter((a,t)=>t!==R);x(s),alert("Item deleted successfully!")}catch(s){console.error("Error deleting item:",s)}finally{y(!1)}};return e.jsxs(X,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(u,{variant:"contained",color:"secondary",onClick:G,children:"Add Item"}),e.jsxs(v,{open:P,onClose:f,children:[e.jsx(k,{style:{backgroundColor:"#f9dff5"},children:j!==null?"Edit Item Details":"Add Item Details"}),e.jsx(D,{style:{backgroundColor:"#f9dff5"},children:e.jsx(I,{sx:{padding:"10px"},elevation:0,style:{backgroundColor:"#f9dff5"},children:e.jsx("form",{children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(E,{fullWidth:!0,required:!0,children:[e.jsx(A,{children:"Category"}),e.jsx(W,{value:r.category_item,name:"category_name",onChange:F,label:"Category",children:O.map(s=>e.jsx(T,{value:s.category_name,children:s.category_name},s.id))})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(E,{fullWidth:!0,required:!0,children:[e.jsx(A,{children:"Sub-Category"}),e.jsx(W,{value:r.sub_category,name:"sub_category",onChange:m,label:"Sub-Category",disabled:!r.category_name,children:B.map(s=>e.jsx(T,{value:s.name,children:s.name},s.id))})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{fullWidth:!0,label:"Item Name",name:"item_name",value:r.item_name,onChange:m,margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"Item Code",name:"item_code",value:r.item_code,onChange:m,margin:"normal"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"HSN Code",name:"hsn_code",value:r.hsn_code,onChange:m,margin:"normal"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:m,margin:"normal"})}),r.sizes.map((s,a)=>e.jsxs(n,{container:!0,item:!0,xs:12,spacing:2,children:[e.jsx(n,{item:!0,xs:4,children:e.jsx(d,{fullWidth:!0,label:"Size",name:"size",value:s.size,onChange:t=>C(t,a),margin:"normal"})}),e.jsx(n,{item:!0,xs:4,children:e.jsx(d,{fullWidth:!0,label:"Unit Price",name:"unit_price",type:"number",value:s.unit_price,onChange:t=>C(t,a),margin:"normal"})}),e.jsx(n,{item:!0,xs:3,children:e.jsx(d,{fullWidth:!0,label:"Stock Quantity",name:"stock_quantity",type:"number",value:s.stock_quantity,onChange:t=>C(t,a),margin:"normal"})}),e.jsx(n,{item:!0,xs:1,sx:{marginTop:"23px"},children:e.jsx(_,{onClick:()=>Q(a),color:"error",children:e.jsx(q,{})})})]},a)),e.jsx(n,{item:!0,xs:12,children:e.jsx(u,{variant:"outlined",color:"secoundary",onClick:M,children:"Add Size"})})]})})})}),e.jsxs(w,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(u,{onClick:f,color:"error",children:"Cancel"}),e.jsx(u,{onClick:J,color:"secoundary",disabled:g.add,children:g.add?e.jsx(ne,{size:24}):"Save"})]})]}),e.jsxs(v,{open:$,onClose:S,children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(D,{children:"Are you sure you want to delete this item?"}),e.jsxs(w,{children:[e.jsx(u,{onClick:S,color:"secondary",children:"Cancel"}),e.jsx(u,{onClick:Y,color:"error",children:"Confirm"})]})]}),e.jsx(ee,{component:I,sx:{marginTop:3},children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsx(N,{children:["Item Name","Item Code","Category","Sub-Category","Sizes","HSN Code","Unit Price","Stock Quantity","Description","Actions"].map(s=>e.jsx(o,{children:s},s))})}),e.jsx(ae,{children:c.map((s,a)=>e.jsxs(N,{children:[e.jsx(o,{children:s.item_name}),e.jsx(o,{children:s.item_code}),e.jsx(o,{children:s.category_item}),e.jsx(o,{children:s.sub_category}),e.jsx(o,{children:s.sizes&&s.sizes.length>0?s.sizes.map(t=>t.size).join(", "):"No sizes available"}),e.jsx(o,{children:Array.isArray(s.sizes)&&s.sizes.length>0?s.sizes.map(t=>t.unit_price).join(", "):"No unit price available"}),e.jsx(o,{children:Array.isArray(s.sizes)&&s.sizes.length>0?s.sizes.map(t=>t.stock_quantity).join(", "):"No stock quantity available"}),e.jsx(o,{children:s.hsn_code}),e.jsx(o,{children:s.description}),e.jsxs(o,{children:[e.jsx(_,{color:"secondary",onClick:()=>K(a),children:e.jsx(re,{})}),e.jsx(_,{color:"error",onClick:()=>V(a),children:e.jsx(q,{})})]})]},s.item_code))})]})})]})}export{le as default};
