import{r as s,j as e,v as F,w as x,D as k,x as v,y as E,z as w,Y as z,Z as H,_ as M,$ as T,F as R,H as A,I as J,J as Q,K as V,M as I,O as l,Q as Y,S as L,U as Z,V as X,W as f}from"./index-B24U4oXx.js";import{C as ee}from"./CircularProgress-BB-a29aZ.js";function se(){const[t,p]=s.useState({tax_name:"",tax_percentage:"",description:""}),[r,u]=s.useState([]),[o,c]=s.useState({add:!1}),[G,h]=s.useState(!1),[d,j]=s.useState(null),[g,O]=s.useState(null),[P,m]=s.useState(!1),N=s.useRef(null),y=s.useRef(null),D=s.useRef(null);s.useEffect(()=>{(async()=>{try{c({...o,fetch:!0});const n=await f.get("/api/user/taxes/");u(n.data.data),alert(n.data.message)}catch(n){console.error("Error fetching tax list",n)}finally{c({...o,fetch:!1})}})()},[]);const C=a=>{p({...t,[a.target.name]:a.target.value})},S=(a,n)=>{var i;a.key==="Enter"&&(a.preventDefault(),(i=n.current)==null||i.focus())},W=()=>{h(!0),j(null)},b=()=>{h(!1)},B=async a=>{if(a.preventDefault(),c({...o,add:!0}),!t.tax_name||!t.tax_percentage){alert("Tax Name and Tax Percentage are required."),c({...o,add:!1});return}try{if(d!==null){const n=await f.put(`/api/user/taxes/${r[d].id}/`,t),i=[...r];i[d]=t,u(i),console.log("Updated",t),alert(n.data.message)}else{const n=await f.post("/api/user/taxes/",t);u([...r,n.data]),console.log("Added",t),alert(n.data.message)}p({tax_name:"",tax_percentage:"",description:""}),j(null),h(!1)}catch(n){console.error("Error adding/updating tax",n)}finally{c({...o,add:!1})}},K=a=>{p(r[a]),j(a),h(!0)},U=a=>{O(a),m(!0)},q=async()=>{try{await f.delete(`/api/user/taxes/${r[g].id}`);const a=r.filter((n,i)=>i!==g);u(a),console.log("Deleted tax at index",g),ae%$%$,m(!1)}catch(a){console.error("Error deleting tax",a)}},_=()=>{m(!1)};return e.jsxs(F,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(x,{variant:"contained",color:"secondary",onClick:W,children:d!==null?"Edit Tax":"Add Tax"}),e.jsxs(k,{open:G,onClose:b,children:[e.jsx(v,{style:{backgroundColor:"#f9dff5"},children:d!==null?"Edit Tax Details":"Add Tax Details"}),e.jsx(E,{style:{backgroundColor:"#f9dff5"},children:e.jsx(w,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(H,{children:"Tax Name"}),e.jsxs(M,{value:t.tax_name,name:"tax_name",onChange:C,label:"Tax Name",inputRef:N,onKeyDown:a=>S(a,y),children:[e.jsx(T,{value:"CGST",children:"CGST"}),e.jsx(T,{value:"SGST",children:"SGST"}),e.jsx(T,{value:"IGST",children:"IGST"})]})]}),e.jsx(R,{fullWidth:!0,label:"Tax Percentage",name:"tax_percentage",value:t.tax_percentage,onChange:C,margin:"normal",required:!0,inputRef:y,onKeyDown:a=>S(a,D)}),e.jsx(R,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:t.description,onChange:C,margin:"normal",inputRef:D})]})})}),e.jsxs(A,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(x,{onClick:b,color:"error",children:"Cancel"}),e.jsx(x,{onClick:B,color:"secondary",disabled:o.add,children:o.add?e.jsx(ee,{size:24}):d!==null?"Update":"Add"})]})]}),e.jsx(J,{component:w,sx:{marginTop:3},children:e.jsxs(Q,{children:[e.jsx(V,{children:e.jsxs(I,{children:[e.jsx(l,{children:"Tax Name"}),e.jsx(l,{children:"Tax Percentage"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Y,{children:(Array.isArray(r)?r:[]).map((a,n)=>e.jsxs(I,{children:[e.jsx(l,{children:a.tax_name}),e.jsx(l,{children:a.tax_percentage}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(L,{color:"primary",onClick:()=>K(n),children:e.jsx(Z,{})}),e.jsx(L,{color:"secondary",onClick:()=>U(n),children:e.jsx(X,{})})]})]},n))})]})}),e.jsxs(k,{open:P,onClose:_,children:[e.jsx(v,{children:"Confirm Delete"}),e.jsx(E,{children:"Are you sure you want to delete this tax entry?"}),e.jsxs(A,{children:[e.jsx(x,{onClick:_,color:"secondary",children:"Cancel"}),e.jsx(x,{onClick:q,color:"error",children:"Confirm"})]})]})]})}export{se as default};
