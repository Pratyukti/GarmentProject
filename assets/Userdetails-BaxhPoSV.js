import{r as n,j as e,v as Z,w as m,D as S,x as T,y as I,z as N,G as o,F as u,Y as X,Z as ee,_ as se,$,H as q,I as re,J as ne,K as le,M as O,O as a,Q as ae,S as L,U as te,V as oe,W as C}from"./index-B24U4oXx.js";import{C as ie}from"./CircularProgress-BB-a29aZ.js";function ue(){const[l,h]=n.useState({user_name:"",fullname:"",email:"",contact_number:"",role:"",password:"",password2:"",description:""}),[c,p]=n.useState([]),[x,j]=n.useState({add:!1}),[F,g]=n.useState(!1),[f,R]=n.useState(null),[P,w]=n.useState(!1),[B,M]=n.useState(null),z=n.useRef(null),U=n.useRef(null),E=n.useRef(null),v=n.useRef(null),k=n.useRef(null),y=n.useRef(null),A=n.useRef(null),_=n.useRef(null);n.useEffect(()=>{(async()=>{j(r=>({...r,fetch:!0}));try{const r=await C.get("api/user/userdetails/");p(r.data)}catch(r){console.error("Error fetching user data:",r)}finally{j(r=>({...r,fetch:!1}))}})()},[]);const i=s=>{h({...l,[s.target.name]:s.target.value})},G=()=>{g(!0),R(null)},K=()=>{g(!1)},H=async s=>{s.preventDefault(),j({...x,add:!0});try{if(f!==null){const r=await C.put(`api/user/userdetails/${l.user_name}/`,l),d=[...c];d[f]=r.data,p(d),console.log("User updated successfully:",r.data),alert("User updated successfully:")}else{const r=await C.post("api/user/userdetails/",l);p([...c,r.data]),console.log("User added successfully:",r.data),alert("User added successfully:")}}catch(r){console.error("Error adding/updating user:",r)}finally{j({...x,add:!1}),h({user_name:"",fullname:"",email:"",contact_number:"",role:"",password:"",password2:"",description:""}),g(!1)}},V=s=>{h(c[s]),R(s),g(!0)},J=s=>{M(s),w(!0)},Q=async s=>{h(c[s]);try{const r=await C.delete(`api/user/userdetails/${l.user_name}/`,l),d=c.filter((D,b)=>b!==B);p(d),console.log("User deleted successfully:",d),alert(`User deleted successfully: ${d}`)}catch(r){if(console.error("Error adding/updating company:",r),r.responce&&r.responce.data&&r.responce.data.error){const d=r.responce.data.error;let D="";for(const[b,Y]of Object.entries(d))D+=`${b.toUpperCase()}: ${Y.join(", ")}
`;alert(`Validation Errors:
${D}`)}else r.message?alert(`Error: ${r.message}`):alert("An unknown error occurred.")}finally{w(!1)}},W=()=>{w(!1)},t=(s,r)=>{s.key==="Enter"&&(s.preventDefault(),r.current&&r.current.focus())};return e.jsxs(Z,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(m,{variant:"contained",color:"secondary",onClick:G,children:f!==null?"Edit User":"Add User"}),e.jsxs(S,{open:F,onClose:K,sx:{"& .MuiDialog-paper":{width:"800px",maxWidth:"none"}},children:[e.jsx(T,{style:{backgroundColor:"#f9dff5"},children:f!==null?"Edit User Details":"Add User Details"}),e.jsx(I,{style:{backgroundColor:"#f9dff5"},children:e.jsx(N,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsx("form",{children:e.jsxs(o,{container:!0,spacing:1,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"User Name",name:"user_name",value:l.user_name,onChange:i,margin:"normal",required:!0,inputRef:z,onKeyDown:s=>t(s,U)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Full Name",name:"fullname",value:l.fullname,onChange:i,margin:"normal",required:!0,inputRef:U,onKeyDown:s=>t(s,E)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:l.email,onChange:i,margin:"normal",required:!0,inputRef:E,onKeyDown:s=>t(s,v)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Contact Number",name:"contact_number",value:l.contact_number,onChange:i,margin:"normal",required:!0,inputRef:v,onKeyDown:s=>t(s,k)})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(X,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(ee,{children:"Role"}),e.jsxs(se,{value:l.role,name:"role",onChange:i,label:"Role",inputRef:k,onKeyDown:s=>t(s,y),children:[e.jsx($,{value:"Admin",onKeyDown:s=>t(s,y),children:" Admin"}),e.jsx($,{value:"Employee",onKeyDown:s=>t(s,y),children:"Employee"})]})]})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Password",name:"password",type:"password",value:l.password,onChange:i,margin:"normal",required:!0,inputRef:y,onKeyDown:s=>t(s,A)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Password2",name:"password2",type:"password",value:l.password2,onChange:i,margin:"normal",required:!0,inputRef:A,onKeyDown:s=>t(s,_)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,multiline:!0,rows:3,label:"Description",name:"description",value:l.description,onChange:i,margin:"normal",inputRef:_,onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()}})})]})})})}),e.jsxs(q,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(m,{onClick:K,color:"error",children:"Cancel"}),e.jsx(m,{onClick:H,color:"secondary",disabled:x.add,children:x.add?e.jsx(ie,{size:24}):f!==null?"Update":"Add"})]})]}),e.jsx(re,{component:N,sx:{marginTop:3},children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(O,{children:[e.jsx(a,{children:"User Name"}),e.jsx(a,{children:"Full Name"}),e.jsx(a,{children:"Email Address"}),e.jsx(a,{children:"Contact Number"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(ae,{children:(Array.isArray(c)?c:[]).map((s,r)=>e.jsxs(O,{children:[e.jsx(a,{children:s.user_name}),e.jsx(a,{children:s.fullname}),e.jsx(a,{children:s.email}),e.jsx(a,{children:s.contact_number}),e.jsx(a,{children:s.role}),e.jsxs(a,{children:[e.jsx(L,{color:"secondary",onClick:()=>V(r),children:e.jsx(te,{})}),e.jsx(L,{color:"error",onClick:()=>J(r),children:e.jsx(oe,{})})]})]},r))})]})}),e.jsxs(S,{open:P,onClose:W,children:[e.jsx(T,{children:"Confirm Delete"}),e.jsx(I,{children:"Are you sure you want to delete this user?"}),e.jsxs(q,{children:[e.jsx(m,{onClick:W,color:"secondary",children:"Cancel"}),e.jsx(m,{onClick:Q,color:"error",children:"Confirm"})]})]})]})}export{ue as default};
